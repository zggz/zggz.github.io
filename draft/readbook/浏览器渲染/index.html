<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Introduction
  #

主要描述浏览器的渲染">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="浏览器渲染" />
<meta property="og:description" content="
  Introduction
  #

主要描述浏览器的渲染" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zggz.github.io/draft/readbook/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93/" /><meta property="article:section" content="draft" />
<meta property="article:published_time" content="2020-11-25T18:14:05+00:00" />
<meta property="article:modified_time" content="2020-11-25T18:14:05+00:00" />

<title>浏览器渲染 | zggz Book</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css" integrity="sha256-gsXb0jRHzuC0wqo&#43;0Izglh&#43;qQOH6Nw7uT4yfAuDUa18=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.bda3e609fa4804070f9c6206b392325ed2bd2127f933b6910405fc8f8a5c0f75.js" integrity="sha256-vaPmCfpIBAcPnGIGs5IyXtK9ISf5M7aRBAX8j4pcD3U=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.gif" alt="Logo" /><span>zggz Book</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>一些杂记</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/notes/vim/" class="">vim常用命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/notes/git/" class="">Git</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/" >
        其他
      </a>
  </li>
  
  <li>
    <a href="/draft/readbook/" >
        读书小记
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>浏览器渲染</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#一个页面页面进程">一个页面页面进程</a></li>
        <li><a href="#导航流程">导航流程</a></li>
        <li><a href="#url请求过程">URL请求过程</a></li>
        <li><a href="#浏览器进程">浏览器进程</a>
          <ul>
            <li><a href="#用户输入">用户输入</a></li>
            <li><a href="#网络进程">网络进程</a></li>
            <li><a href="#渲染进程">渲染进程</a></li>
            <li><a href="#提交文档">提交文档</a></li>
            <li><a href="#渲染阶段">渲染阶段</a></li>
            <li><a href="#布局阶段">布局阶段</a></li>
            <li><a href="#其他">其他</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h2 id="introduction">
  Introduction
  <a class="anchor" href="#introduction">#</a>
</h2>
<p>主要描述浏览器的渲染</p>
<h2 id="一个页面页面进程">
  一个页面页面进程
  <a class="anchor" href="#%e4%b8%80%e4%b8%aa%e9%a1%b5%e9%9d%a2%e9%a1%b5%e9%9d%a2%e8%bf%9b%e7%a8%8b">#</a>
</h2>
<ol>
<li>浏览器进程
<ul>
<li>界面显示、用户交互、子进程管理</li>
</ul>
</li>
<li>渲染进程
<ul>
<li>核心将html、css、JavaScript转换成用户可以交互的网页</li>
<li>排版引擎blink</li>
<li>JavaScript引擎V8</li>
</ul>
</li>
<li>GPU进程
<ul>
<li>最初实现CSS3效果</li>
<li>最后chrome的UI和网页都是采用GPU来绘制</li>
</ul>
</li>
<li>网络进程
<ul>
<li>主要负责网络资源加载</li>
</ul>
</li>
<li>插件进程
<ul>
<li>插件的运行隔离</li>
</ul>
</li>
</ol>
<!-- more -->
<h2 id="导航流程">
  导航流程
  <a class="anchor" href="#%e5%af%bc%e8%88%aa%e6%b5%81%e7%a8%8b">#</a>
</h2>
<p>（用户发出URL请求到页面开始解析的过程，叫做导航）</p>
<h2 id="url请求过程">
  URL请求过程
  <a class="anchor" href="#url%e8%af%b7%e6%b1%82%e8%bf%87%e7%a8%8b">#</a>
</h2>
<h2 id="浏览器进程">
  浏览器进程
  <a class="anchor" href="#%e6%b5%8f%e8%a7%88%e5%99%a8%e8%bf%9b%e7%a8%8b">#</a>
</h2>
<h3 id="用户输入">
  用户输入
  <a class="anchor" href="#%e7%94%a8%e6%88%b7%e8%be%93%e5%85%a5">#</a>
</h3>
<ul>
<li>如果是搜索内容，会使用搜索引搜索</li>
<li>如果是URL，会根据URL规范合成完整的协议</li>
</ul>
<h3 id="网络进程">
  网络进程
  <a class="anchor" href="#%e7%bd%91%e7%bb%9c%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<ul>
<li>浏览器进程通过  （IPC）将请求交给网络进程</li>
<li>网络进程首先会检查本地储存</li>
<li>进入网络请求流程
<ul>
<li>DNS解析
<ul>
<li>获取IP</li>
<li>如果是https请求，还需要 建立TLS</li>
</ul>
</li>
<li>收到响应头和响应行，就开始解析响应头的内容</li>
<li>如果响应状态码是301、302</li>
<li>从响应头的 Location 字段里面读取重定向的地址</li>
<li>响应数据类型处理</li>
<li>浏览器根据content-type来决定如何显示响应内容</li>
</ul>
</li>
</ul>
<h3 id="渲染进程">
  渲染进程
  <a class="anchor" href="#%e6%b8%b2%e6%9f%93%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<ol>
<li>
<p>打开一个新页面采用的渲染进程策略就是：通常情况下，打开新的页面都会使用单独的渲染进程；</p>
</li>
<li>
<p>如果从 A 页面打开 B 页面，且 A 和 B 都属于同一站点的话，那么 B 页面复用 A 页面的渲染进程；</p>
</li>
<li>
<p>如果是其他情况，浏览器进程则会为 B 创建一个新的渲染进程。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>	<span style="color:#75715e"># 渲染进程将 HTML 内容转换为能够读懂的 DOM 树结构。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 渲染引擎将 CSS 样式表转化为浏览器可以理解的 styleSheets，计算出 DOM 	节点的样式。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 创建布局树，并计算元素的布局信息。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 对布局树进行分层，并生成分层树。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 为每个图层生成绘制列表，并将其提交到合成线程。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 合成线程发送绘制图块命令 DrawQuad 给浏览器进程。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 浏览器进程根据 DrawQuad 消息生成页面，并显示到显示器上。</span>
</span></span></code></pre></div><p>``</p>
</li>
</ol>
<h3 id="提交文档">
  提交文档
  <a class="anchor" href="#%e6%8f%90%e4%ba%a4%e6%96%87%e6%a1%a3">#</a>
</h3>
<ul>
<li>将网络进程收到的html数据，交给渲染进程的过程</li>
<li>首先当浏览器 进程收到网络进程的响应头，便向浏览器发起“提交文档”</li>
<li>渲染进程收到提交文档消息后，会和网络进程建立传输数据通道</li>
<li>等文档传输完成，渲染进程会返回“确认提交”的消息给浏览器进程</li>
<li>浏览器进程收到“确认消息”，会更新浏览器界面</li>
</ul>
<h3 id="渲染阶段">
  渲染阶段
  <a class="anchor" href="#%e6%b8%b2%e6%9f%93%e9%98%b6%e6%ae%b5">#</a>
</h3>
<ul>
<li>构建 DOM: 将html转换成树形结构</li>
<li>样式计算</li>
<li>将css文本转换成styleSheets。</li>
<li>转换属性值，使标准化</li>
<li>计算每个结点的样式
<ul>
<li>继承</li>
<li>层叠</li>
</ul>
</li>
</ul>
<h3 id="布局阶段">
  布局阶段
  <a class="anchor" href="#%e5%b8%83%e5%b1%80%e9%98%b6%e6%ae%b5">#</a>
</h3>
<ul>
<li>计算出 DOM 树中可见元素的几何位置，我们把这个计算过程叫做布局。</li>
<li>创建布局树
<ul>
<li>遍历所有可见节点 ，并把这些节点加到 布局树中</li>
<li>布局计算</li>
</ul>
</li>
<li>分层
<ul>
<li>为特定的节点生成专用的图层，并生成一颗图层树</li>
<li>拥有层叠上下文属性的元素会被提升为单独的一层。</li>
<li>第二点，需要剪裁（clip）的地方也会被创建为图层。</li>
</ul>
</li>
<li>绘制
<ul>
<li>待绘制列表</li>
</ul>
</li>
<li>分块
<ul>
<li>当绘制列表准备好以后，主线程会将它提交给合成线程</li>
<li>合成线程会将图层划分为图块（tile）</li>
</ul>
</li>
<li>栅格化
<ul>
<li>将图块转换为位图</li>
<li>GPU 来加速生成，使用 GPU 生成位图的过程叫快速栅格化，或者 GPU 栅格化，生成的位图被保存在 GPU 内存中。</li>
<li>最终生成位图都是在GPU中完成的</li>
</ul>
</li>
<li>合成
<ul>
<li>一旦所有图块都被光栅化，合成线程就会生成一个绘制图块的命令——“DrawQuad”，然后将该命令提交给浏览器进程。</li>
</ul>
</li>
</ul>
<h3 id="其他">
  其他
  <a class="anchor" href="#%e5%85%b6%e4%bb%96">#</a>
</h3>
<ul>
<li>
<p>重排</p>
<ul>
<li>更新了元素的几何属性（重排）</li>
<li>重排需要更新完整的渲染流水线，所以开销也是最大的。</li>
<li>width、height、margin、border</li>
</ul>
</li>
<li>
<p>重绘</p>
<ul>
<li>更新元素的绘制属性（重绘）</li>
<li>重绘省去了布局和分层阶段，所以执行效率会比重排操作要高一些。</li>
<li>color、border-style、background、text-decoration、outline</li>
</ul>
</li>
<li>
<p>合成</p>
<ul>
<li>既不要布局也不要绘制的属性</li>
<li>transform</li>
</ul>
</li>
</ul></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/zggz/zggz//blob/main//content/draft/readbook/%e6%b5%8f%e8%a7%88%e5%99%a8%e6%b8%b2%e6%9f%93.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#一个页面页面进程">一个页面页面进程</a></li>
        <li><a href="#导航流程">导航流程</a></li>
        <li><a href="#url请求过程">URL请求过程</a></li>
        <li><a href="#浏览器进程">浏览器进程</a>
          <ul>
            <li><a href="#用户输入">用户输入</a></li>
            <li><a href="#网络进程">网络进程</a></li>
            <li><a href="#渲染进程">渲染进程</a></li>
            <li><a href="#提交文档">提交文档</a></li>
            <li><a href="#渲染阶段">渲染阶段</a></li>
            <li><a href="#布局阶段">布局阶段</a></li>
            <li><a href="#其他">其他</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












